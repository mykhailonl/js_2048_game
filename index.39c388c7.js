var t,e={};const i=new((t=class{constructor(t=[]){t.length?this.initialState=t:this.initialState=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.status="idle",this.score=0,this.currentState=this.initialState.map(t=>[...t])}isGameOver(){"lose"===this.getStatus()?document.querySelector(".message-lose").classList.remove("hidden"):"win"===this.getStatus()&&document.querySelector(".message-win").classList.remove("hidden")}checkWinCondition(){return this.currentState.some(t=>t.includes(2048))}checkMovePossibility(){if(this.getEmptyCellsCoordinates().length>0)return!0;for(let t=0;t<4;t++)for(let e=0;e<4;e++){let i=this.checkCellByCoordinates([t,e]);if(e<3&&i===this.checkCellByCoordinates([t,e+1])||t<3&&i===this.checkCellByCoordinates([t+1,e]))return!0}return!1}moveDown(){if("playing"!==this.getStatus())return;let t=JSON.stringify(this.currentState);for(let t=3;t>=0;t--){let e=[!1,!1,!1,!1];for(let i=3;i>=0;i--){let s=this.checkCellByCoordinates([i,t]);if(0!==s){let r=i,n=r+1;for(;n<=3&&0===this.checkCellByCoordinates([n,t]);)this.currentState[n][t]=s,this.currentState[r][t]=0,r=n,n++;n<=3&&this.checkCellByCoordinates([n,t])===s&&!e[n]&&(this.currentState[n][t]*=2,this.currentState[r][t]=0,this.score+=this.currentState[n][t],e[n]=!0)}}}t===JSON.stringify(this.currentState)||(this.checkWinCondition()&&(this.status="win"),this.generateAndPositionNewTile(),this.updateTheBoard(),this.checkMovePossibility()||(this.status="lose"))}moveUp(){if("playing"!==this.getStatus())return;let t=JSON.stringify(this.currentState);for(let t=0;t<4;t++){let e=[!1,!1,!1,!1];for(let i=0;i<4;i++){let s=this.checkCellByCoordinates([i,t]);if(0!==s){let r=i,n=r-1;for(;n>=0&&0===this.checkCellByCoordinates([n,t]);)this.currentState[n][t]=s,this.currentState[r][t]=0,r=n,n--;n>=0&&this.checkCellByCoordinates([n,t])===s&&!e[n]&&(this.currentState[n][t]*=2,this.currentState[r][t]=0,this.score+=this.currentState[n][t],e[n]=!0)}}}t===JSON.stringify(this.currentState)||(this.checkWinCondition()&&(this.status="win"),this.generateAndPositionNewTile(),this.updateTheBoard(),this.checkMovePossibility()||(this.status="lose"))}moveLeft(){if("playing"!==this.getStatus())return;let t=JSON.stringify(this.currentState);for(let t=0;t<4;t++){let e=this.currentState[t].filter(t=>0!==t);e=[...e,...Array(4-e.length).fill(0)],this.currentState[t]=e;let i=[!1,!1,!1,!1];for(let e=0;e<3;e++){let s=this.checkCellByCoordinates([t,e]);0===s||this.checkCellByCoordinates([t,e+1])!==s||i[e]||(this.currentState[t][e]*=2,this.currentState[t][e+1]=0,this.score+=this.currentState[t][e],i[e]=!0)}e=[...e=this.currentState[t].filter(t=>0!==t),...Array(4-e.length).fill(0)],this.currentState[t]=e}t===JSON.stringify(this.currentState)||(this.checkWinCondition()&&(this.status="win"),this.generateAndPositionNewTile(),this.updateTheBoard(),this.checkMovePossibility()||(this.status="lose"))}moveRight(){if("playing"!==this.getStatus())return;let t=JSON.stringify(this.currentState);for(let t=0;t<4;t++){let e=this.currentState[t].filter(t=>0!==t);e=[...Array(4-e.length).fill(0),...e],this.currentState[t]=e;let i=[!1,!1,!1,!1];for(let e=3;e>0;e--){let s=this.checkCellByCoordinates([t,e]);0===s||this.checkCellByCoordinates([t,e-1])!==s||i[e]||(this.currentState[t][e]*=2,this.currentState[t][e-1]=0,this.score+=this.currentState[t][e],i[e]=!0)}e=[...Array(4-(e=this.currentState[t].filter(t=>0!==t)).length).fill(0),...e],this.currentState[t]=e}t===JSON.stringify(this.currentState)||(this.checkWinCondition()&&(this.status="win"),this.generateAndPositionNewTile(),this.updateTheBoard(),this.checkMovePossibility()||(this.status="lose"))}updateTheScore(){document.querySelector(".game-score").innerText=this.score}getScore(){return this.score}getState(){return this.currentState}getStatus(){return this.status}generateAndPositionNewTile(){this.positionNewTile(this.generateNewTile())}initializeBoard(){this.generateAndPositionNewTile(),this.generateAndPositionNewTile()}start(){this.status="playing",this.initializeBoard(),this.updateTheBoard()}restart(){this.score=0,this.status="idle",this.currentState=this.initialState.map(t=>[...t]),this.updateTheBoard()}resetTheField(){let t=this.getNonEmptyCells(),e=this.getState();t.forEach(t=>{e[t[0]][t[1]]=0}),this.updateTheBoard()}generateNewTile(){return .1>Math.random()?4:2}positionNewTile(t){let e=this.getEmptyCellsCoordinates(),i=e[Math.floor(Math.random()*e.length)];e.length?this.getState()[i[0]][i[1]]=t:this.checkMovePossibility()}getEmptyCellsCoordinates(){let t=[];for(let e=0;e<this.getState().length;e++)for(let i=0;i<this.getState()[e].length;i++)0===this.currentState[e][i]&&t.push([e,i]);return t}getNonEmptyCells(){let t=[];for(let e=0;e<this.getState().length;e++)for(let i=0;i<this.getState()[e].length;i++)0!==this.currentState[e][i]&&t.push([e,i]);return t}checkCellByCoordinates([t,e]){return t>=0&&t<4&&e>=0&&e<4?this.currentState[t][e]:null}updateTheBoard(){let t=[...document.querySelectorAll("tr.field-row")],e=this.currentState;if(0!==t.length)for(let i=0;i<e.length;i++)for(let s=0;s<e[i].length;s++){let r=t[i].children[s],n=e[i][s];r.className="field-cell",0!==n?(r.classList.add(`field-cell--${n}`),r.innerText=n):r.innerText=""}}}).__esModule?t.default:t),s=t=>{t.classList.remove("start"),t.classList.add("restart"),t.innerText="Restart"},r=()=>{[...document.querySelectorAll(".message")].forEach(t=>t.classList.add("hidden"))};document.addEventListener("DOMContentLoaded",()=>{let t=document.querySelector(".button");t&&t.addEventListener("click",()=>{"idle"===i.getStatus()?(i.start(),s(t),r()):"playing"===i.getStatus()?(i.restart(),i.start()):"lose"===i.getStatus()&&(i.restart(),i.start(),r())})}),document.addEventListener("keydown",t=>{if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.key)&&t.preventDefault(),"playing"===i.getStatus()){switch(t.key){case"ArrowUp":i.moveUp();break;case"ArrowDown":i.moveDown();break;case"ArrowLeft":i.moveLeft();break;case"ArrowRight":i.moveRight()}("win"===i.getStatus()||"lose"===i.getStatus())&&i.isGameOver(),i.updateTheScore(),i.updateTheBoard()}});
//# sourceMappingURL=index.39c388c7.js.map
